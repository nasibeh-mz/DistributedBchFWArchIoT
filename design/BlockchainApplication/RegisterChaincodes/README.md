# Register Chaincodes

The register chaincodes are responsible for verifying register petitions and creating transactions in the ledger.

## Register Author

This chaincode verifies the public code sent in the petition and creates the register code to be assocciated with that key into a KeyPair.

![Register Author](AuthorRegisterChaincode.drawio.png?raw=true "Register Author")

1- Chaincode is called. Call contains a RegisterPetition. See [RegisterPetiton](../../DataStructures/RegisterAuthorStructures).

2- Author's public key is used to obtain the signed message using RSA.

3- Signed and unsigned messages are compared. If identical, the author's identity is verified, as the message signed with the private 
key of the author can only be decrypted using their public key.

4- A register key is generated for the author. Can be generated by a CA or by a local method but they must be Unique.

5- A transaction is requested to store the KeyPair generated. See [KeyPair](../../DataStructures/RegisterAuthorStructures).

6- Response is sent. If successful, the register code is sent(201). If not, an error message is sent(403).

## Register Update

This chaincode stores an Update in the blockchain.

![Register Update](UpdateRegisterChaincode.drawio.png?raw=true "Register Update")

1- Chaincode is called. Call contains an UpdateRegister. See [RegisterPetiton](../../DataStructures/RegisterAuthorStructures).

2- The RegisterKey is verified to be in the ledger, and the assocciated PublicKey is obtained. See [KeyPair](../../DataStructures/RegisterAuthorStructures).

3- ManifestDigest field is removed from manifest, and its digested using SHA 384, or any other algortithm specified in PayloadFormat or PayloadProccesing.
Manifest is verifies to contain all the mandatory fields.

4- PublicKey is used to obtain the contents of the ManifestSign.

5- ManifestDigest field, manifest digest and signed message are compared. If identical, the manifest is verified not to have been modified since the author
signed it.

6- PublicKey is used to obtain the content of the AuthorSign.

7- Hash algortithm is used to obtain the payload's digest.

8- The digest, sign content and PayloadDigest field are compared. If identical, the payload/image is verified not to have been modified.

9- An UpdateInChain is generated from Update and PublicKey.

10- A transaction is requested to store the generated UpdateInChain.

11- Response is sent. If successful, a code 201. If not, a code 403 containing the error in a message.

## Add CID to Update

This chaincodes modifies a stored Update to add the CID of the assocciated image/payload.

![Add CID](UpdateCIDChaincode.drawio.png?raw=true "Add CID")

1- Chaincode is called. Call contains an UpdatePetition. See [UpdatePetition](../../DataStructures/UpdatePetition).

2- RegisterKey is used to obtain PublicKey. See [KeyPair](../../DataStructures/RegisterAuthorStructures).

3- UpdateInChain obtained using PublicKey, VersionID and ClassID.

4- CID is added to UpdateInChain.

5- Transaction is requested to store the modifications.

6- Response is sent. If successful, code 201 is sent. If not, a code 403 or 404 is sent, according to the generated error message.

